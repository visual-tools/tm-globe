<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Use correct character set. -->
  <meta charset="utf-8">
  <!-- Tell IE to use the latest, best version. -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <title>TM Forum - Accelerating Industry Transformation Through Collaboration</title>
  <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico" />
  <script src="../Build/Cesium/Cesium.js"></script>
  <style>
      @import url(../Build/Cesium/Widgets/widgets.css);
      html, body, #cesiumContainer {
          position: relative; width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
      }
      #logoContainer {
          position: absolute; right: 35px; bottom: 0px; height: 60px;
      }
      #titleContainer {
          position: absolute; left: 10px; top: 10px; color: white; font-family: "helvetica";
      }
  </style>
  <link rel="stylesheet" type="text/css" href="css/tmforum.globe.visual.tools.css">
</head>
<body>
  <div id="cesiumContainer"></div>
  <div id="titleContainer">
    <H2 style="margin-top: 0px; margin-bottom: 0px;">TMForum Smart City Forum</H2>
    <H3 style="margin-top: 5px;">Case Studies</H3>
  </div>
  <div id="creditContainer"></div>
  <div id="logoContainer">
    <a href="https://www.tmforum.org"><img src="images/tmforum_logo.png" title="TM Forum" style="height: 100%;" /></a>
  </div>
  <script>
    // Set the default camera location for the viewer - somewhere in the middle east
    Cesium.Camera.DEFAULT_VIEW_FACTOR = 1;
    Cesium.Camera.DEFAULT_VIEW_RECTANGLE = Cesium.Rectangle.fromDegrees(30,10,50,30);
    
    // Create a Cesium viewer with an Open Street Maps map on it
    //   the open street maps map has maximum level detail of 4, which seems to be all the countries and some major cities
    var viewer = new Cesium.Viewer('cesiumContainer', {
        imageryProvider : new Cesium.createOpenStreetMapImageryProvider
            ( { "maximumLevel": 4,
              },
            ),
        creditContainer: 'creditContainer',
        baseLayerPicker : false,
    });

    
    // TODO: keep the earth at natural North / South alignment
    var scene = viewer.scene;
    // scene.screenSpaceCameraController.enableTilt = false;
    // // scene.screenSpaceCameraController.enableRotate = false;
    // scene.screenSpaceCameraController.enableLook = false;

    // Keep the camera responsive and reasonable
    //   TODO: add a maximumZoomDistance
    scene.screenSpaceCameraController._minimumZoomRate = 3000000
    scene.screenSpaceCameraController.minimumZoomDistance=2000000;

    // Fix the container infoBox Iframe will not let javascript run in embedded iframes
    var iframe = document.getElementsByClassName('cesium-infoBox-iframe')[0];
    iframe.setAttribute('sandbox', 'allow-same-origin allow-scripts allow-popups allow-forms'); 

    // create content data dictionary
    var contentByLocationDict = 
    { "Brisbane": { "latitude": -27.46794, "longditude": 153.02809,
                    "billboardImage": "images/countryNames/brisbane.png",
                    "video": '<iframe src="https://player.vimeo.com/video/182895881?title=0&byline=0&portrait=0"  width="100%" height="300px" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen sandbox="allow-same-origin allow-scripts allow-popups allow-forms"></iframe>',
                    "pdf": "BrisbaneCaseStudy.pdf",
                    "labelOffsetX": 30,
                    "labelOffsetY": -15,
                  },
      "Boston": { "latitude": 42.364506, "longditude": -71.038887,
                  "billboardImage": "images/countryNames/boston.png",
                  "video": '<iframe src="https://player.vimeo.com/video/183007848?title=0&byline=0&portrait=0" width="100%" height="300px" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen sandbox="allow-same-origin allow-scripts allow-popups allow-forms"></iframe>',
                  "pdf": "BostonCaseStudy.pdf",
                  "labelOffsetX": 50,
                  "labelOffsetY": 0,
                  },
    }

    // create Helper function to add content to dictionary
    var addContent = 
      ( countryName, latitude, longditude, video, pdf, labelOffsetX, labelOffsetY ) =>    
      { contentByLocationDict[countryName] = 
          { "latitude": latitude, "longditude": longditude, 
            // "billboardImage": "images/countryNames/"+countryName.toLowerCase(), 
            // "billboardImage": "images/countryNames/boston.png",
            "video":    video,
            "pdf":      pdf,
            "pdfURL":   "contentAssets/SmartCityCaseStudies/"+pdf,
            "labelOffsetX": labelOffsetX,
            "labelOffsetY": labelOffsetY,
          }
    	}

      // add the content
      addContent
        ( "Atlanta",
          33.7679192,-84.5606908,
          '<iframe src="https://player.vimeo.com/video/140048801?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
          "AtlantaCaseStudy.pdf",
        );
      addContent
        ( "City of Phoenix", 
          33.448376, -112.074036, 
          '<iframe src="https://player.vimeo.com/video/182562653?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
        );
      addContent
        ( // Name of the Location
          "Bonn", 
          // Lat / Long of the location
          50.7374, 7.0982, 
          // html content to embed in the infobox
          '<iframe src="https://player.vimeo.com/video/182895880?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
          // pdf download content
          "BonnCaseStudy.pdf",
          // pixel offset for the location label 
          68, 25,
        );
      addContent
        ( "Bristol",
          51.4686194,-2.7307936,
          '<iframe src="https://player.vimeo.com/video/139925846?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
          "BristolCaseStudy.pdf",
          -10, 50,
        );
      addContent
        ( "Buenos Aires",
          -34.6154611,-58.5733854,
          '<iframe src="https://player.vimeo.com/video/183142715?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
          "BuenosAiresCaseStudy.pdf",
        );
      addContent
        ( "Dheli-Mumbai Corridor",
         23.431749,75.563965,
         '<iframe src="https://player.vimeo.com/video/183142713?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
         "",
         40, -10,
       );
      addContent
        ( "Dholera",
          22.2388351,72.1639649,
          "",
          "DholeraCaseStudy.pdf",
          -30, 50,
        );
      addContent
        ( "Dubai",
          25.0757073,54.9475419,
          '<iframe src="https://player.vimeo.com/video/183295147?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
          "DubaiCaseStudy.pdf",
          0, -10,
        );
      addContent
        ( "Indonesia",
          -6.175110,106.865039,
          "",
          "IndonesiaCaseStudy.pdf",
        );
      addContent
        ( "Ipswich",
          -27.695544, 152.685365,
          '<iframe src="https://player.vimeo.com/video/183023794?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
          "",
          -30, 45,
        );
      addContent
        ( "Johannesburg",
          -26.1713505,27.9699836,
          '<iframe src="https://player.vimeo.com/video/183295148?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
          "JohannesburgCaseStudy.pdf",
        );
      addContent
        ( "Masdar",
          24.4264395,54.6017502,
          '<iframe src="https://player.vimeo.com/video/183142714?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
          "MasdarCaseStudy.pdf",
          0, 45,
        );
      addContent
        ( "Milton Keynes",
          52.0403, -0.6831,
          '<iframe src="https://player.vimeo.com/video/183142712?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
          "MiltonKeynesCaseStudy.pdf",
        );
      addContent
        ( "Nusantara",
          -3.4560339,108.5172527,
          'https://vimeo.com/channels/1130523/page:2'
        );
      addContent
        ( "NYC, New York",
          40.6976701,-74.2598775,
          "",
          "NYCCaseStudy.pdf",
          0, 50
        );
      addContent
        ( "Pakistan",
          30.0679939,60.3256431,
          "",
          "PakistanCaseStudy.pdf",
        );
      addContent
        ( "Palo Alto",
          37.4257657,-122.2053908,
          '<iframe src="https://player.vimeo.com/video/182547765?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
          "PaloAltoCaseStudy.pdf",
        );
      addContent
        ( "Singapore",
          1.3143394,103.70416,
          "",
          "SingaporeCaseStuday.pdf",
        );
      addContent
        ( "St Quentin",
          49.847066, 3.2874,
          '<iframe src="https://player.vimeo.com/video/183125915?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
          "",
          40, 55
        );
      
      addContent
        ( "Singapore",
          1.2800945, 103.85094909999998,
          '<iframe src="https://player.vimeo.com/video/183185396?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
        );
      addContent
        ( "Tampere",
          61.49911, 23.78712,
          '<iframe src="https://player.vimeo.com/video/183177689?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
          "TampereCaseStuday.pdf",
        );
      addContent
        ( "Toronto",
          43.6570321,-79.6010444,
          "",
          "TorontoCaseStudy.pdf",
        );
      addContent
        ( "Vancouver",
          49.246292, -123.11622,
          '<iframe src="https://player.vimeo.com/video/183219589?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',
        );
      addContent
        ( "Yinchuan",
          38.46806, 106.27306,
          '<iframe src="https://player.vimeo.com/video/182547769?title=0&byline=0&portrait=0" width="100%" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>'
        );


    // Iterate through the dictionary and create the interface components
    Object.keys(contentByLocationDict)
      .forEach
      ( (locationName, index) =>
        { // get value from the dictionary  by key
          var value = contentByLocationDict[locationName];
          
          // calculate the offset in pixels of the label
          //   default is to place the label just above the location (0, -25)
          var labelOffsetX = 0;
          var labelOffsetY = -25;
          if (value.labelOffsetX) labelOffsetX += value.labelOffsetX;
          if (value.labelOffsetY) labelOffsetY += value.labelOffsetY;

          // build the Cesium Entity to add
          //   (sadly the cesium API page doesnt link to individual entries)
          //   but the API page is here: https://cesiumjs.org/refdoc/
          var entityToAdd =
            { // this is used for the infobox heading
              name: locationName,
              // long lat
              position : Cesium.Cartesian3.fromDegrees(value.longditude, value.latitude),
              // not used
              viewFrom: new Cesium.ConstantPositionProperty(Cesium.Cartesian3(0,0, 30000)),
              
              // written label on map
              label: 
              { 
                      text: locationName, 
                      font: '28pt Helvetica', 
                      
                      scale: 1.0, 
                      
                      verticalOrigin: Cesium.VerticalOrigin.CENTER, 
                      pixelOffset: new Cesium.Cartesian2(labelOffsetX, labelOffsetY),


                      style: Cesium.LabelStyle.FILL_AND_OUTLINE, 
                      fillColor: Cesium.Color.BLACK,
                      outlineColor: Cesium.Color.YELLOW,
                      
                      // this used to shrink the labels when the user zooms out
                      scaleByDistance: new Cesium.NearFarScalar(1.5e2, 1.5, 4.0e7, 0.0),
                      // this is used to make the shrinking look more accurate
                      pixelOffsetScaleByDistance: new Cesium.NearFarScalar(1.5e2, 1.0, 4.0e7, 0.1),
              },
              point: 
              {       // A red dot for the location
                      color: new Cesium.Color(1.0, 0.0, 0.0, 1.0),
                      pixelSize: 4
              },
              // insert the stylesheet into the infobox iframe
              description: 
                '<link rel="stylesheet" type="text/css" href="css/tmforum.globe.visual.tools.css">' +
                ''
                ,
          }
          // add the pdf and its image if necessary
          if (value.pdf)
          { entityToAdd.description += '<p class="description pdf"><a href="'+value.pdfURL+'" target="_blank" download >Download ' + locationName + ' PDF Case Study </a></p>';
            if (! value.video)
            { entityToAdd.description += '<p class="description video image"><img height="360px" width="90%" src="'  + value.pdfURL + '.jpg"></img></p>';
            }
          }  
          // add the embeded HTML content
          if (value.video)
          { entityToAdd.description += '<p class="description video">'  + value.video  +'</p>';
          }
          
          // add the entity to the viewer entityCollection
          viewer.entities.add(entityToAdd); 
        }
      );
  </script>
</body>
</html>
